# v5.2 Fuzzing Engine Integration (FuzzNode) Implementation Plan

**Goal:** Integrate a containerized AFL++ (QEMU mode) fuzzing engine with automated crash triage.

**Context:** Part of the v5.0 "Horde" Swarm Architecture. This version provides the "Search for Vulnerabilities" capability for binary targets.

---

## Phase A: Infrastructure & Executor Layer

### Task 1: Fuzzing Docker Environment

- [ ] **Step 1.1: Create `docker/Dockerfile.fuzzer`**
  - Base: `debian:stable-slim`.
  - Install `AFL++`, `qemu-user`, `gdb`, `python3`.
  - Install `gdb-exploitable` plugin for auto-triage.
- [ ] **Step 1.2: Implement Docker Manager Helper**
  - Create `src/asas_mcp/executors/docker_manager.py` using `docker-py`.
  - Provide abstractions for `start_fuzzer_container` and `exec_in_fuzzer`.

---

## Phase B: Core Fuzzing Tools (MCP)

### Task 2: Fuzzing Control Tool (`pwn_fuzz_start`)

- [ ] **Step 2.1: Implement `pwn_fuzz_start(binary_path, duration_min, seed_dir)`**
  - Logic: Spin up container, mount binary, run `afl-fuzz -Q`.
  - Return: Container ID and status.

### Task 3: Crash Monitoring & Triage (`pwn_fuzz_triage`)

- [ ] **Step 3.1: Implement `pwn_fuzz_check(container_id)`**
  - Return `afl-whatsup` stats (crashes found, coverage).
- [ ] **Step 3.2: Implement `pwn_fuzz_triage(container_id, crash_id)`**
  - Logic: Run the crashing input through GDB + `exploitable`.
  - Return: JSON report with Registers, IP, and vulnerability classification.

---

## Phase C: Agent Integration

### Task 4: PwnAgent / ReverseAgent Upgrade

- [ ] **Step 4.1: Bind Fuzzing tools to Agents**
  - Update `src/asas_agent/agents/reverse.py` (or create `pwn.py`).
- [ ] **Step 4.2: SOP Update**
  - Add "If static analysis fails, start a 10-minute Fuzzing session" to the System Prompt.

---

## Phase D: E2E Verification

### Task 5: The "Vulnerable Service" Test

- [ ] **Step 5.1: Create `tests/agent/test_fuzz_e2e_v5.py`**
  - Mock Docker interactions.
  - Verify Agent starts fuzzing ⇨ notices crash ⇨ triages crash ⇨ identifies overflow.

---

## Tech Stack

- **AFL++**: Implementation via QEMU for binary-only support.
- **Docker SDK for Python**: For container management.
- **GDB-Exploitable**: For automated crash classification.
