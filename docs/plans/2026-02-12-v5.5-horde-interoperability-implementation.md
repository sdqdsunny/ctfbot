# v5.5 Horde Interoperability Implementation Plan

**Goal:** Establish a bidirectional feedback loop between Fuzzing (AFL++) and Symbolic Execution (Angr).

**Core Concept:** Use Angr to "punch through" logical bottlenecks that the Fuzzer cannot penetrate, and use Fuzzer seeds to guide Angr deeper into the program.

---

## Phase A: Seed Exchange Infrastructure

### Task 1: Corpus Extraction Logic

- [ ] **Step 1.1: Extend `DockerManager` for File Extraction**
  - Implement `extract_seeds(container_id, count=10)`: Read files from `/data/out/default/queue/`.
  - Implement `inject_seed(container_id, seed_content)`: Write a new solution to `/data/in/` or directly into the fuzzer queue.
- [ ] **Step 1.2: Seed Processor Utility**
  - Create `src/asas_mcp/utils/seed_processor.py`: Convert raw binary AFL++ seeds into Stdin inputs for Angr.

---

## Phase B: Telemetry & Stagnation Detection

### Task 2: Real-time Telemetry Service

- [ ] **Step 2.1: Enhance `pwn_fuzz_check`**
  - Parse raw `afl-whatsup` output into a structured JSON.
  - Fields: `unique_crashes`, `unique_paths`, `last_path_sec_ago`, `execs_per_sec`.
- [ ] **Step 2.2: Implement Orchestrator Stagnation Node**
  - Add a logic in the graph: `if last_path_sec_ago > 120` ⇨ Emit `STAGNATION_EVENT`.

---

## Phase C: Hybrid Solving Node (The Feedback Loop)

### Task 3: Guided Symbolic Solving

- [ ] **Step 3.1: Upgrade `reverse_angr_solve`**
  - Support `initial_input` parameter to start exploration from a specific Fuzzer path.
- [ ] **Step 3.2: Implement `horde_bridge_solve_fuzz_bottleneck` Tool**
  - Logic: Pick the best seed ⇨ Run Angr to flip the next unvisited branch ⇨ Return decoded solution string.

---

## Phase D: Agent Synergy & SOP Upgrade

### Task 4: ReverseAgent Autonomous Horde Mode

- [ ] **Step 4.1: SOP: Hybrid Bottleneck Breaking**
  - Add instructions: "If Fuzzing shows stagnation, pull the latest seeds and use Angr to solve the blockage."
- [ ] **Step 4.2: Automated Re-injection**
  - Agent logic: When Angr solves a branch, immediately call `pwn_fuzz_inject_seed` to re-energize the Fuzzer.

---

## Phase E: E2E Verification

### Task 5: The "Magic Value Check" Challenge

- [ ] **Step 5.1: Create `tests/agent/test_horde_interop_e2e_v5.py`**
  - Scenario: A binary requires a 4-byte random password that Fuzzing can't guess.
  - Expected Flow: Fuzz stalls ⇨ Orchestrator triggers Angr ⇨ Angr solves the 4-byte check ⇨ Angr injects seed ⇨ Fuzz finds the crash/success point.

---

## Technical Challenges

- **State Synchronization**: Ensuring the seed found by Fuzzer correctly maps to the execution state in Angr.
- **Queue Interruption**: Handling how AFL++ reacts to seeds injected into its queue while running.
