# CTF-ASAS v2.0 深度工具集成 - 自动化逆向模块 (Ghidra Integration) 设计方案

## 1. 目标

通过集成 Ghidra Headless，赋予 Agent 深度理解二进制逻辑的能力，实现从单纯的“字符串提取”到“伪代码逻辑分析”的跨越。

## 2. 核心组件

- **Ghidra Headless Analyzer**: 利用 Ghidra 的命令行工具进行后台分析。
- **Ghidra MCP Toolset**:
  - `reverse_analyze_binary`: 执行基础分析并生成项目文件。
  - `reverse_decompile_function`: 反编译指定地址或名称的函数。
  - `reverse_get_cfg`: 提取函数控制流图 (CFG) 数据。
- **Code Distiller (逻辑蒸馏)**: 将冗长的 C 伪代码提炼为关键逻辑特征（如：S-Box、异或常量、循环结构），以节省 LLM Token 并提高效率。

## 3. 架构设计

### 3.1 模块结构

```text
ctfbot/
├── src/
│   ├── asas_mcp/
│   │   ├── tools/
│   │   │   ├── reverse_ghidra.py  # [新增] Ghidra Headless 封装
│   │   │   └── scripts/           # Ghidra Python (Jython) 脚本
│   │   │       └── decompile.py 
├── assets/                        # 存放 Ghidra 项目文件
```

### 3.2 逻辑流

1. **识别**: Agent 发现题目附件为 ELF/PE 文件。
2. **分析**: 调用 `reverse_analyze_binary` 初始化项目。
3. **定位**: 自动寻找 `main` 或关键逻辑函数（如 `check_flag`）。
4. **反编译**: 提取伪代码。
5. **推理**: Agent 分析伪代码逻辑（例如：判断出是 TEA 算法），生成并在沙箱中测试 Python 解题脚本。

## 4. 实施阶段 (Milestones)

- **Phase 1: 环境依赖构建**: 安装 Ghidra 或配置 Docker 镜像环境。
- **Phase 2: MCP 工具开发**: 封装 `analyzeHeadless` 命令行调用，编写 Jython 脚本。
- **Phase 3: Agent 节点升级**: 增加 `Analyze_Logic` 节点，专门处理反编译后的语义理解。
- **Phase 4: 实战验证**: 自动化解出一道 Simple Reverse 题目。

---
Thought in Chinese: 深度逆向是提升 Agent 智商的关键一步。
